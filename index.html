<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AniList User Checker</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { padding: 8px; margin: 5px; }
  </style>
</head>
<body style="text-align: center">
  <h2>Compare Users</h2>
  <div>
  <input type="text" id="user1"  placeholder="My username" value="coffeee"></input>
  <input type="text" id="user2"  placeholder="Your username" value="awspear"> </input>
  </div>
  <button id = "getusers">Compare users</button>
  <p id="result"></p>
  <p id="testing"></p>
  <script>
    document.getElementById("getusers").addEventListener("click", listofoperations);
    let userlisttwo;
    let userlistone;
    let userone_standerizedlist;
    let usertwo_standerizedlist;
     async function listofoperations() {
      await getuserdata();
      userlistone = await standerizelists(userlistone);
      userlisttwo = await standerizelists(userlisttwo);
      //await matchlists();
      //await comparelists();
      //await calculatefinalstandarddeviation():
      document.getElementById("result").innerHTML += `<p> did it work? ${JSON.stringify(userlistone, null, 2)}`;
    }
    
    async function getuserdata() {
      document.getElementById("result").innerHTML = `<p> please be patient! it is loading! </p>`;
        for (let i=1; i <3; i++) {
          let username = document.getElementById(`user${i}`).value;
          const query = `
            query($userName: String) {
              MediaListCollection(userName: $userName, type: ANIME,status: COMPLETED, sort: FINISHED_ON ){
                user{
                  name
                    statistics{
                      anime{
                        count
                        meanScore
                        standardDeviation
                      }
                    }
                }
                lists{
                  name
                    entries{
                      score
                        media{
                          id
                        }
                    }
                }
              }
            }
        `;
        let variables = { userName: username };

        const response = await fetch('https://graphql.anilist.co', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          },
          body: JSON.stringify({ query, variables }),
        });
        if (i == 1) { 
         userlistone = await response.json();
        } else {
        userlisttwo = await response.json();
        }
        }
      document.getElementById("result").innerHTML = `<p> ${JSON.stringify(userlistone, null, 2)} ok \n</p>`;
    }
    function standerizelists(userlist) {
    let temp = userlist['data']['MediaListCollection']['lists'][0];
    let new_entry ={};
    let mean = userlist['data']['MediaListCollection']['user']['statistics']['anime']['meanScore'];
    let SD = userlist['data']['MediaListCollection']['user']['statistics']['anime']['standardDeviation'];
    let new_list = [];
    for (let i=0; i < temp['entries'].length;i++) {
      let new_score = ((temp['entries'][i]['score'] * 10) - mean) / SD;
      console.log(new_score);
      console.log("test");
      new_entry.score = new_score;
      new_entry.media = temp['entries'][i]['media'];
      new_list.push(new_entry);
    }
    console.log(new_list);
    console.log(temp);
    return new_list;
    }
  </script>
</body>
</html>
